"use strict";(self["webpackChunktraveljp"]=self["webpackChunktraveljp"]||[]).push([[298],{3857:function(e,a,o){o.d(a,{vL:function(){return l},zp:function(){return t}});o(8675),o(3462);const t=(e,a="已複製",o="該瀏覽器不支援複製功能")=>{const t=navigator.clipboard.writeText(e);t.then((()=>{"已複製"!==a&&alert(a)})).catch((()=>{alert(o)}))},l=e=>e<10?`0${e}`:e},9697:function(e,a,o){o.r(a),o.d(a,{default:function(){return U}});o(6905),o(9007);var t=o(3266),l=o(730),n=o(6807),s=o(3652),r=o(3396);const d={class:"flex flex-wrap"},i=["onClick"],p=["onClick"];function u(e,a,o,u,c,m){const g=s.$Y,h=s.eI,D=n.Z,_=(0,r.up)("Template"),b=l.Z,f=(0,r.up)("Form"),v=t.Z;return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("div",null,[(0,r._)("button",{type:"button",onClick:a[0]||(a[0]=e=>{u.isNew=!0,u.isOpenModal=!0,u.getModalData()}),class:"primaryBtn mb-3"}," 新增 ")]),(0,r.Wm)(h,{data:u.rows,stripe:"",style:{width:"100%"},border:""},{default:(0,r.w5)((()=>[(0,r.Wm)(g,{align:"center",sortable:"",prop:"title",label:"優惠券"}),(0,r.Wm)(g,{align:"center",sortable:"",prop:"code",label:"優惠碼"}),(0,r.Wm)(g,{align:"center",sortable:"",prop:"percent",label:"折扣優惠"}),(0,r.Wm)(g,{align:"center",sortable:"",prop:"due_date",label:"優惠結束日期"}),(0,r.Wm)(g,{align:"center",sortable:"",prop:"cn_is_enable",label:"是否啟用"}),(0,r.Wm)(g,null,{default:(0,r.w5)((e=>[(0,r._)("div",d,[(0,r._)("button",{type:"button",class:"primaryBtn mr-2",onClick:a=>{u.isNew=!1,u.isOpenModal=!0,u.getModalData(e.row)}}," 編輯 ",8,i),(0,r._)("button",{class:"dangerBtn",type:"button",onClick:a=>{u.isNew=!1,u.isOpenDelModal=!0,u.getModalData(e.row)}}," 刪除 ",8,p)])])),_:1})])),_:1},8,["data"]),u.rows?.length>0?((0,r.wg)(),(0,r.j4)(D,{key:0,onHandleCurrentPage:u.changePage,total:u.paginationInfo.total_pages},null,8,["onHandleCurrentPage","total"])):(0,r.kq)("",!0),(0,r.Wm)(f,null,{default:(0,r.w5)((({errors:e,handleSubmit:o})=>[(0,r.Wm)(b,{onChangeVisible:a[1]||(a[1]=e=>u.isOpenModal=!1),onSendModalData:a[2]||(a[2]=e=>u.sendModalData(u.couponData)),isOpenModal:u.isOpenModal,isNew:u.isNew,handleSubmit:o},{content:(0,r.w5)((()=>[(0,r.Wm)(_,{errors:e,onGetFormData:u.getFormData,couponData:u.couponData},null,8,["errors","onGetFormData","couponData"])])),_:2},1032,["isOpenModal","isNew","handleSubmit"])])),_:1}),(0,r.Wm)(v,{itemTitle:u.couponData.title,onChangeVisible:a[3]||(a[3]=e=>u.isOpenDelModal=!1),isOpenDelModal:u.isOpenDelModal,onSendModalData:a[4]||(a[4]=e=>u.delCoupon(u.couponData))},null,8,["itemTitle","isOpenDelModal"])],64)}var c=o(6265),m=o.n(c),g=o(4870),h=o(65),D=o(7139),_=o(9242);const b={class:"flex flex-col"},f={class:"flex flex-col"},v=(0,r._)("span",{class:"modalTitle"},"優惠券名稱",-1),I={class:"primary-red font-bold"},w={class:"flex flex-col"},M=(0,r._)("span",{class:"modalTitle"},"優惠碼",-1),O={class:"primary-red font-bold"},y={class:"flex flex-col"},x=(0,r._)("span",{class:"modalTitle"},"折扣優惠(百分比)",-1),F={class:"primary-red font-bold"},C={class:"flex flex-col"},N=(0,r._)("span",{class:"modalTitle"},"優惠結束日期",-1),V={class:"primary-red font-bold"},W={class:"flex flex-col"},S=(0,r._)("span",{class:"modalTitle"},"是否啟用",-1),$=(0,r._)("option",{value:1},"是",-1),L=(0,r._)("option",{value:0},"否",-1),T=[$,L];function k(e,a,o,t,l,n){const s=(0,r.up)("Field");return(0,r.wg)(),(0,r.iD)("section",b,[(0,r._)("div",f,[v,(0,r.Wm)(s,{name:"優惠券名稱",rules:"required",onInput:t.handleForm,modelValue:t.coupon.title,"onUpdate:modelValue":a[0]||(a[0]=e=>t.coupon.title=e),modelModifiers:{trim:!0},class:"modalInput",placeholder:"請輸入優惠券名稱",type:"text"},null,8,["onInput","modelValue"]),(0,r._)("span",I,(0,D.zw)(o.errors.優惠券名稱),1)]),(0,r._)("div",w,[M,(0,r.Wm)(s,{name:"優惠碼",rules:"required",onInput:t.handleForm,modelValue:t.coupon.code,"onUpdate:modelValue":a[1]||(a[1]=e=>t.coupon.code=e),modelModifiers:{trim:!0},class:"modalInput",placeholder:"請輸入優惠碼",type:"text"},null,8,["onInput","modelValue"]),(0,r._)("span",O,(0,D.zw)(o.errors.優惠碼),1)]),(0,r._)("div",y,[x,(0,r.Wm)(s,{name:"折扣優惠",rules:"required",onInput:t.handleForm,modelValue:t.coupon.percent,"onUpdate:modelValue":a[2]||(a[2]=e=>t.coupon.percent=e),modelModifiers:{number:!0},class:"modalInput",placeholder:"請輸入折扣優惠",type:"number"},null,8,["onInput","modelValue"]),(0,r._)("span",F,(0,D.zw)(o.errors.折扣優惠),1)]),(0,r._)("div",C,[N,(0,r.Wm)(s,{name:"優惠結束日期",rules:"required",onInput:t.handleForm,modelValue:t.coupon.due_date,"onUpdate:modelValue":a[3]||(a[3]=e=>t.coupon.due_date=e),class:"modalInput",placeholder:"請選擇優惠結束日期",type:"date"},null,8,["onInput","modelValue"]),(0,r._)("span",V,(0,D.zw)(o.errors.優惠結束日期),1)]),(0,r._)("div",W,[S,(0,r.wy)((0,r._)("select",{onChange:a[4]||(a[4]=(...e)=>t.handleForm&&t.handleForm(...e)),"onUpdate:modelValue":a[5]||(a[5]=e=>t.coupon.is_enabled=e),class:"modalInput"},T,544),[[_.bM,t.coupon.is_enabled]])])])}var G=o(5708),j={name:"CouponTemplate",props:{couponData:{type:Object,required:!0},errors:{type:Object}},emits:["getFormData","getFIle"],setup(e,{emit:a}){const o=(0,g.Vh)(e,"couponData"),t=()=>{a("getFormData",o.value)};return{props:e,coupon:o,handleForm:t}},components:{Field:G.gN}},A=o(89);const H=(0,A.Z)(j,[["render",k]]);var Z=H,q=o(3857),z={name:"BCoupon",setup(){const e=(0,g.iH)(!1),a=(0,g.iH)(!1),o=(0,g.iH)(!1),t=(0,r.f3)("$ElNotification"),l=(0,h.oR)(),n=(0,g.iH)([]),s=(0,g.iH)({}),d=(0,g.iH)({}),i=e=>{c(e)},p=e=>{o.value?d.value={title:"",is_enabled:1,percent:100,due_date:"",code:""}:d.value=e},u=e=>{d.value=e},c=e=>{const a=`https://vue3-course-api.hexschool.io/api/traveljp/admin/coupons?page=${e}`;l.commit("ISLOADING",!0),m().get(a).then((e=>{e.data.success?(n.value=e.data.coupons,n.value.forEach((e=>{e.cn_is_enable=e.is_enabled?"是":"否";const a=new Date(e.due_date),o=a.getFullYear(),t=(0,q.vL)(a.getMonth()+1),l=(0,q.vL)(a.getDate());e.due_date=`${o}-${t}-${l}`})),s.value=e.data.pagination):t({title:"錯誤",message:e.data.message,type:"error"}),l.commit("ISLOADING",!1)})).catch((e=>{e&&l.commit("ISLOADING",!1)}))},D=e=>{let a="",n="";o.value?(a="https://vue3-course-api.hexschool.io/api/traveljp/admin/coupon",n="post"):(a=`https://vue3-course-api.hexschool.io/api/traveljp/admin/coupon/${e.id}`,n="put"),e={...e,due_date:Math.floor(new Date(e.due_date).getTime())},l.commit("ISLOADING",!0),m()[n](a,{data:e}).then((e=>{e.data.success?(t({title:"成功",message:`${e.data.message}`,type:"success"}),c(1)):(t({title:"錯誤",message:`${e.data.message}`,type:"error"}),l.commit("ISLOADING",!1))})).catch((e=>{e&&l.commit("ISLOADING",!1)}))},_=e=>{const o=`https://vue3-course-api.hexschool.io/api/traveljp/admin/coupon/${e.id}`;l.commit("ISLOADING",!0),m()["delete"](o).then((e=>{e.data.success?(t({title:"成功",message:`${e.data.message}`,type:"success"}),c(1),a.value=!1):(l.commit("ISLOADING",!1),t({title:"錯誤",message:`${e.data.message}`,type:"error"}))})).catch((e=>{e&&l.commit("ISLOADING",!1)}))};return(0,r.bv)((()=>{c(1)})),{rows:n,paginationInfo:s,isNew:o,couponData:d,isOpenModal:e,isOpenDelModal:a,changePage:i,getFormData:u,sendModalData:D,getModalData:p,delCoupon:_}},components:{Pagination:n.Z,CommonModal:l.Z,DelCommonModal:t.Z,Template:Z,Form:G.l0}};const P=(0,A.Z)(z,[["render",u]]);var U=P}}]);