"use strict";(self["webpackChunktraveljp"]=self["webpackChunktraveljp"]||[]).push([[822],{2265:function(e,t,a){a.r(t),a.d(t,{default:function(){return se}});var l=a(3396),s=a(7139),o=a(9242);const r=(0,l._)("section",{class:"text-center w-5/6 md:w-4/5 lg:w-3/5 mx-auto pt-44 flex"},[(0,l._)("p",{class:"py-2 flex-1 px-5 text-md sm:text-lg md:text-xl font-bold bg-primary-red rounded-t-md"}," 1. 購物明細 "),(0,l._)("p",{class:"py-2 flex-1 px-5 text-md sm:text-lg md:text-xl font-bold bg-primary-retouch2 rounded-t-md"}," 2. 確認訂單 "),(0,l._)("p",{class:"py-2 flex-1 px-5 text-md sm:text-lg md:text-xl font-bold bg-primary-retouch2 rounded-t-md"}," 3. 完成訂購 ")],-1),c={class:"w-5/6 md:w-4/5 lg:w-3/5 mx-auto pt-10 primary-black"},n={class:"flex items-center justify-between border-b-4 pb-10"},d=(0,l._)("h1",{class:"text-3xl md:text-4xl lg:text-5xl font-bold"},"購物明細",-1),m={class:"text-2xl md:text-3xl lg:text-4xl font-bold"},p=(0,l._)("thead",null,[(0,l._)("tr",{class:"leading-loose"},[(0,l._)("th"),(0,l._)("th",null,"商品"),(0,l._)("th",null,"人數"),(0,l._)("th",null,"單價"),(0,l._)("th",null,"小計"),(0,l._)("th")])],-1),i={class:"w-1/5"},u=["src"],x={class:"pl-1"},h={class:"text-sm sm:text-md md:text-lg text-justify"},_={class:"primary-red text-justify"},g={class:"text-center"},f=["onUpdate:modelValue","onChange"],y={class:"text-sm sm:text-md w-1/5 text-center font-bold"},b={class:"text-sm sm:text-md w-1/5 text-center font-bold"},I={key:0,class:"primary-red"},w={class:"mb-4 border-t-4 pt-4"},D={key:1,class:"flex flex-col"},v={class:"modalTitle"},k=(0,l.Uk)("優惠券 "),S={key:2,class:"primary-red font-bold"},O={class:"block"},C=["onSubmit"],A={class:"flex flex-col"},N=(0,l._)("label",{class:"modalTitle"},"訂購人名稱",-1),L={class:"primary-red font-bold"},G={class:"flex flex-col"},V=(0,l._)("label",{class:"modalTitle"},"聯絡信箱",-1),q={class:"primary-red font-bold"},j={class:"flex flex-col"},z=(0,l._)("label",{class:"modalTitle"},"連絡電話",-1),U={class:"primary-red font-bold"},T={class:"flex flex-col"},W=(0,l._)("label",{class:"modalTitle"},"訂購地址",-1),B={class:"primary-red font-bold"},F={class:"flex flex-col"},H=(0,l._)("label",{class:"modalTitle"},"備註",-1),E={class:"mt-5 mb-10 bg-primary-retouch rounded p-5 flex justify-between items-center"},P=(0,l.Uk)("繼續購物 "),$={class:"text-right"},M={class:"mr-5 font-bold otherFont text-lg"},Q=(0,l._)("button",{type:"submit",class:"commonBtn"},"確認訂單",-1);function Y(e,t,a,Y,J,K){const R=(0,l.up)("font-awesome-icon"),Z=(0,l.up)("Field"),X=(0,l.up)("router-link"),ee=(0,l.up)("Form");return(0,l.wg)(),(0,l.iD)(l.HY,null,[r,(0,l._)("section",c,[(0,l._)("div",n,[d,(0,l._)("span",m,"共 "+(0,s.zw)(Y.productsData.length)+" 項",1)]),(0,l._)("table",null,[p,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(Y.productsData,(e=>((0,l.wg)(),(0,l.iD)("tr",{class:"border-b-2",key:e.id},[(0,l._)("td",i,[(0,l._)("img",{src:e.product?.imagesUrl[0],alt:""},null,8,u)]),(0,l._)("td",x,[(0,l._)("h3",h,(0,s.zw)(e.product?.title),1),(0,l._)("p",_,(0,s.zw)(e.product?.category),1)]),(0,l._)("td",g,[(0,l.wy)((0,l._)("input",{class:"modalInput w-3/5 md:w-2/5",min:"1",type:"number","onUpdate:modelValue":t=>e.qty=t,onChange:t=>Y.changeQty(e)},null,40,f),[[o.nr,e.qty]])]),(0,l._)("td",y,(0,s.zw)(e.product?.price),1),(0,l._)("td",b,[(0,l._)("span",{class:(0,s.C_)([e.total!==e.final_total?"line-through":"","primary-black block"])},(0,s.zw)(e.total),3),e.total!==e.final_total?((0,l.wg)(),(0,l.iD)("span",I,(0,s.zw)(e.final_total),1)):(0,l.kq)("",!0)]),(0,l._)("td",null,[(0,l.Wm)(R,{class:"text-gray-500 hover:primary-black cursor-pointer",icon:["fas","trash-alt"],onClick:t=>Y.delShoppingCart(e.id)},null,8,["onClick"])])])))),128))])]),(0,l._)("button",{type:"button",onClick:t[0]||(t[0]=(...e)=>Y.delAllProduct&&Y.delAllProduct(...e)),class:"hover:primary-red my-5"}," 整批刪除 "),(0,l._)("section",w,[Y.isOpenCouponBox||Y.productsData[0]?.coupon?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("button",{key:0,class:"commonBtn",onClick:t[1]||(t[1]=e=>Y.isOpenCouponBox=!0)}," 使用優惠券 ")),Y.isOpenCouponBox&&!Y.productsData[0]?.coupon?((0,l.wg)(),(0,l.iD)("div",D,[(0,l._)("label",v,[k,(0,l._)("span",{onClick:t[2]||(t[2]=e=>Y.isOpenCouponBox=!1),class:"cursor-pointer text-sm text-slate-400 hover:primary-black"},"取消"),(0,l._)("span",{onClick:t[3]||(t[3]=(...e)=>Y.sendCoupon&&Y.sendCoupon(...e)),class:"ml-2 cursor-pointer text-sm text-slate-400 hover:primary-red"},"送出")]),(0,l.wy)((0,l._)("input",{class:"modalInput",type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>Y.code=e)},null,512),[[o.nr,Y.code]])])):(0,l.kq)("",!0),Y.productsData[0]?.coupon?((0,l.wg)(),(0,l.iD)("div",S,[(0,l._)("span",O,"已套用："+(0,s.zw)(Y.productsData[0]?.coupon.title),1),(0,l._)("span",null,"折扣："+(0,s.zw)(Y.productsData[0]?.coupon.percent)+"%",1)])):(0,l.kq)("",!0)]),(0,l.Wm)(ee,{class:"border-t-4 pt-4",as:"div"},{default:(0,l.w5)((({errors:e,handleSubmit:a})=>[(0,l._)("form",{onSubmit:(0,o.iM)((e=>a(Y.sendOrderInfo)),["stop","prevent"])},[(0,l._)("div",A,[N,(0,l.Wm)(Z,{name:"訂購人",rules:"required",placeholder:"請輸入訂購人名稱",class:"modalInput",type:"text",modelValue:Y.userData.name,"onUpdate:modelValue":t[5]||(t[5]=e=>Y.userData.name=e)},null,8,["modelValue"]),(0,l._)("span",L,(0,s.zw)(e.訂購人),1)]),(0,l._)("div",G,[V,(0,l.Wm)(Z,{name:"聯絡信箱",rules:"required|email",placeholder:"請輸入聯絡信箱",class:"modalInput",type:"text",modelValue:Y.userData.email,"onUpdate:modelValue":t[6]||(t[6]=e=>Y.userData.email=e)},null,8,["modelValue"]),(0,l._)("span",q,(0,s.zw)(e.聯絡信箱),1)]),(0,l._)("div",j,[z,(0,l.Wm)(Z,{name:"連絡電話",rules:"required",placeholder:"請輸入連絡電話",class:"modalInput",type:"text",modelValue:Y.userData.tel,"onUpdate:modelValue":t[7]||(t[7]=e=>Y.userData.tel=e)},null,8,["modelValue"]),(0,l._)("span",U,(0,s.zw)(e.連絡電話),1)]),(0,l._)("div",T,[W,(0,l.Wm)(Z,{name:"訂購地址",rules:"required",placeholder:"請輸入訂購地址",class:"modalInput",type:"text",modelValue:Y.userData.address,"onUpdate:modelValue":t[8]||(t[8]=e=>Y.userData.address=e)},null,8,["modelValue"]),(0,l._)("span",B,(0,s.zw)(e.訂購地址),1)]),(0,l._)("div",F,[H,(0,l.wy)((0,l._)("textarea",{class:"modalInput",placeholder:"給我們的留言","onUpdate:modelValue":t[9]||(t[9]=e=>Y.userData.message=e)},null,512),[[o.nr,Y.userData.message]])]),(0,l._)("div",E,[(0,l.Wm)(X,{to:{name:"ShopList"}},{default:(0,l.w5)((()=>[(0,l.Wm)(R,{class:"pr-2",icon:["fas","arrow-left"]}),P])),_:1}),(0,l._)("div",$,[(0,l._)("span",M,"總金額: "+(0,s.zw)(Y.computedTotal),1),Q])])],40,C)])),_:1})])],64)}var J=a(6265),K=a.n(J),R=a(4870),Z=a(678),X=a(65),ee=a(5708),te={name:"ShoppingCart",setup(){const e=(0,Z.tv)(),t=(0,R.iH)([]),a=(0,X.oR)(),s=(0,l.f3)("$ElNotification"),o=(0,R.qj)({name:"",email:"",tel:"",address:"",message:""}),r=(0,R.iH)(""),c=(0,R.iH)(!1),n=()=>{const l="https://vue3-course-api.hexschool.io/api/traveljp/cart";a.commit("ISLOADING",!0),K().get(l).then((l=>{l.data.success?(0===l.data.data.carts.length&&(alert("購物車暫無商品，將返回商品列表"),e.push({name:"ShopList"})),t.value=l.data.data.carts,t.value.forEach((e=>{e.final_total=Math.floor(e.final_total)}))):s({title:"錯誤",message:l.data.message,type:"error"}),a.commit("ISLOADING",!1)})).catch((e=>{e&&a.commit("ISLOADING",!1)}))},d=e=>{const t=`https://vue3-course-api.hexschool.io/api/traveljp/cart/${e}`;a.commit("ISLOADING",!0),K()["delete"](t).then((e=>{e.data.success?(s({title:"成功",message:e.data.message,type:"success"}),n()):s({title:"錯誤",message:e.data.message,type:"error"}),a.commit("ISLOADING",!1)})).catch((e=>{e&&a.commit("ISLOADING",!1)}))},m=()=>{const e="https://vue3-course-api.hexschool.io/api/traveljp/carts";a.commit("ISLOADING",!0),K()["delete"](e).then((e=>{e.data.success||s({title:"錯誤",message:e.data.message,type:"error"}),n(),a.commit("ISLOADING",!1)})).catch((e=>{e&&a.commit("ISLOADING",!1)}))},p=e=>{e.qty<1&&(s({title:"提示",message:"數量不得小於 1",type:"warning"}),e.qty=1)},i=async e=>{const t=`https://vue3-course-api.hexschool.io/api/traveljp/cart/${e.id}`;a.commit("ISLOADING",!0),await p(e);const l={product_id:e.product_id,qty:e.qty};await K().put(t,{data:l}).then((e=>{e.data.success?n():(s({title:"錯誤",message:e.data.message,type:"error"}),a.commit("ISLOADING",!1))})).catch((e=>{e&&a.commit("ISLOADING",!1)}))},u=()=>{const t="https://vue3-course-api.hexschool.io/api/traveljp/order",l={name:o.name,email:o.email,tel:o.tel,address:o.address},r=o.message;a.commit("ISLOADING",!0),K().post(t,{data:{user:l,message:r}}).then((t=>{t.data.success?e.push({name:"CheckOrder",params:{orderId:t.data.orderId}}):s({title:"錯誤",message:t.data.message,type:"error"}),a.commit("ISLOADING",!1)})).catch((()=>{a.commit("ISLOADING",!1)}))},x=()=>{const e="https://vue3-course-api.hexschool.io/api/traveljp/coupon",t={code:r.value};a.commit("ISLOADING",!0),K().post(e,{data:t}).then((e=>{e.data.success?(s({title:"成功",message:e.data.message,type:"success"}),n()):s({title:"錯誤",message:e.data.message,type:"error"}),a.commit("ISLOADING",!1)})).catch((e=>{e&&a.commit("ISLOADING",!1)}))};(0,l.bv)((()=>{if(n(),sessionStorage.getItem("user")){let e=JSON.parse(sessionStorage.getItem("user"));o.name=e.name,o.tel=e.tel,o.email=e.email}}));const h=(0,l.Fl)((()=>{let e=0;return t.value.forEach((t=>{e+=t.final_total})),e}));return{productsData:t,delShoppingCart:d,changeQty:i,delAllProduct:m,sendOrderInfo:u,sendCoupon:x,code:r,computedTotal:h,userData:o,isOpenCouponBox:c}},components:{Field:ee.gN,Form:ee.l0}},ae=a(89);const le=(0,ae.Z)(te,[["render",Y]]);var se=le}}]);