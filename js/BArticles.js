"use strict";(self["webpackChunktraveljp"]=self["webpackChunktraveljp"]||[]).push([[866],{3857:function(e,t,n){n.d(t,{vL:function(){return o},zp:function(){return a}});n(8675),n(3462);const a=(e,t="已複製",n="該瀏覽器不支援複製功能")=>{const a=navigator.clipboard.writeText(e);a.then((()=>{"已複製"!==t&&alert(t)})).catch((()=>{alert(n)}))},o=e=>e<10?`0${e}`:e},8401:function(e,t,n){n.r(t),n.d(t,{default:function(){return Oe}});n(6905),n(9007);var a=n(3266),o=n(730),l=n(6807),i=n(3652),r=n(3396);const s={class:"flex flex-wrap"},c=["onClick"],u=["onClick"];function d(e,t,n,d,p,m){const f=i.$Y,g=i.eI,v=l.Z,h=(0,r.up)("Template"),y=o.Z,b=(0,r.up)("Form"),D=a.Z;return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("div",null,[(0,r._)("button",{type:"button",onClick:t[0]||(t[0]=e=>{d.isNew=!0,d.isOpenModal=!0,d.getModalData()}),class:"primaryBtn mb-3"}," 新增 ")]),(0,r.Wm)(g,{data:d.rows,stripe:"",style:{width:"100%"},border:""},{default:(0,r.w5)((()=>[(0,r.Wm)(f,{align:"center",sortable:"",prop:"title",label:"標題"}),(0,r.Wm)(f,{align:"center",sortable:"",prop:"description",label:"摘要"}),(0,r.Wm)(f,{align:"center",sortable:"",prop:"author",label:"作者"}),(0,r.Wm)(f,{align:"center",sortable:"",prop:"tag",label:"Tag"}),(0,r.Wm)(f,{align:"center",sortable:"",prop:"create_at_form",label:"更新日期"}),(0,r.Wm)(f,{align:"center",sortable:"",prop:"cn_isPublic",label:"是否公開"}),(0,r.Wm)(f,null,{default:(0,r.w5)((e=>[(0,r._)("div",s,[(0,r._)("button",{type:"button",class:"primaryBtn mr-2",onClick:t=>{d.isNew=!1,d.isOpenModal=!0,d.getModalData(e.row)}}," 編輯 ",8,c),(0,r._)("button",{class:"dangerBtn",type:"button",onClick:t=>{d.isNew=!1,d.isOpenDelModal=!0,d.getModalData(e.row,"del")}}," 刪除 ",8,u)])])),_:1})])),_:1},8,["data"]),d.rows?.length>0?((0,r.wg)(),(0,r.j4)(v,{key:0,onHandleCurrentPage:d.changePage,total:d.paginationInfo.total_pages},null,8,["onHandleCurrentPage","total"])):(0,r.kq)("",!0),(0,r.Wm)(b,null,{default:(0,r.w5)((({errors:e,handleSubmit:n})=>[(0,r.Wm)(y,{onChangeVisible:t[1]||(t[1]=e=>d.isOpenModal=!1),onSendModalData:t[2]||(t[2]=e=>d.sendModalData(d.articleData)),isOpenModal:d.isOpenModal,isNew:d.isNew,handleSubmit:n},{content:(0,r.w5)((()=>[(0,r.Wm)(h,{errors:e,onGetFormData:d.getFormData,articleData:d.articleData},null,8,["errors","onGetFormData","articleData"])])),_:2},1032,["isOpenModal","isNew","handleSubmit"])])),_:1}),(0,r.Wm)(D,{itemTitle:d.articleData.title,onChangeVisible:t[3]||(t[3]=e=>d.isOpenDelModal=!1),isOpenDelModal:d.isOpenDelModal,onSendModalData:t[4]||(t[4]=e=>d.delArticle(d.articleData))},null,8,["itemTitle","isOpenDelModal"])],64)}var p=n(6265),m=n.n(p),f=n(4870),g=n(65);n(1430);function v(e,t,n,a,o,l){const i=(0,r.up)("Editor",!0);return(0,r.wg)(),(0,r.j4)(i,{"api-key":e.apiKey,init:e.init},null,8,["api-key","init"])}var h=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],y=function(e){return-1!==h.map((function(e){return e.toLowerCase()})).indexOf(e.toLowerCase())},b=function(e,t,n){Object.keys(t).filter(y).forEach((function(a){var o=t[a];"function"===typeof o&&("onInit"===a?o(e,n):n.on(a.substring(2),(function(e){return o(e,n)})))}))},D=function(e,t,n,a){var o=e.modelEvents?e.modelEvents:null,l=Array.isArray(o)?o.join(" "):o;(0,r.YP)(a,(function(t,a){n&&"string"===typeof t&&t!==a&&t!==n.getContent({format:e.outputFormat})&&n.setContent(t)})),n.on(l||"change input undo redo",(function(){t.emit("update:modelValue",n.getContent({format:e.outputFormat}))}))},w=function(e,t,n,a,o,l){a.setContent(l()),n.attrs["onUpdate:modelValue"]&&D(t,n,a,o),b(e,n.attrs,a)},I=0,C=function(e){var t=Date.now(),n=Math.floor(1e9*Math.random());return I++,e+"_"+n+I+String(t)},_=function(e){return null!==e&&"textarea"===e.tagName.toLowerCase()},x=function(e){return"undefined"===typeof e||""===e?[]:Array.isArray(e)?e:e.split(" ")},S=function(e,t){return x(e).concat(x(t))},O=function(e){return null===e||void 0===e},k=function(){return{listeners:[],scriptId:C("tiny-script"),scriptLoaded:!1}},M=function(){var e=k(),t=function(e,t,n,a){var o=t.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.id=e,o.src=n;var l=function(){o.removeEventListener("load",l),a()};o.addEventListener("load",l),t.head&&t.head.appendChild(o)},n=function(n,a,o){e.scriptLoaded?o():(e.listeners.push(o),n.getElementById(e.scriptId)||t(e.scriptId,n,a,(function(){e.listeners.forEach((function(e){return e()})),e.scriptLoaded=!0})))},a=function(){e=k()};return{load:n,reinitialize:a}},A=M(),N=function(){return"undefined"!==typeof window?window:n.g},V=function(){var e=N();return e&&e.tinymce?e.tinymce:null},L={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return"html"===e||"text"===e}}},F=function(){return F=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},F.apply(this,arguments)},j=function(e,t,n,a){return e(a||"div",{id:t,ref:n})},P=function(e,t,n){return e("textarea",{id:t,visibility:"hidden",ref:n})},U=(0,r.aZ)({props:L,setup:function(e,t){var n=e.init?F({},e.init):{},a=(0,f.BK)(e),o=a.disabled,l=a.modelValue,i=a.tagName,s=(0,f.iH)(null),c=null,u=e.id||C("tiny-vue"),d=e.init&&e.init.inline||e.inline,p=!!t.attrs["onUpdate:modelValue"],m=!0,g=e.initialValue?e.initialValue:"",v="",h=function(e){return p?function(){return(null===l||void 0===l?void 0:l.value)?l.value:""}:function(){return e?g:v}},y=function(){var a=h(m),o=F(F({},n),{readonly:e.disabled,selector:"#"+u,plugins:S(n.plugins,e.plugins),toolbar:e.toolbar||n.toolbar,inline:d,setup:function(o){c=o,o.on("init",(function(n){return w(n,e,t,o,l,a)})),"function"===typeof n.setup&&n.setup(o)}});_(s.value)&&(s.value.style.visibility=""),V().init(o),m=!1};(0,r.YP)(o,(function(e){var t;null!==c&&("function"===typeof(null===(t=c.mode)||void 0===t?void 0:t.set)?c.mode.set(e?"readonly":"design"):c.setMode(e?"readonly":"design"))})),(0,r.YP)(i,(function(e){var t;p||(v=c.getContent()),null===(t=V())||void 0===t||t.remove(c),(0,r.Y3)((function(){return y()}))})),(0,r.bv)((function(){if(null!==V())y();else if(s.value&&s.value.ownerDocument){var t=e.cloudChannel?e.cloudChannel:"5",n=e.apiKey?e.apiKey:"no-api-key",a=O(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+n+"/tinymce/"+t+"/tinymce.min.js":e.tinymceScriptSrc;A.load(s.value.ownerDocument,a,y)}})),(0,r.Jd)((function(){null!==V()&&V().remove(c)})),d||((0,r.dl)((function(){m||y()})),(0,r.se)((function(){var e;p||(v=c.getContent()),null===(e=V())||void 0===e||e.remove(c)})));var b=function(e){var t;v=c.getContent(),null===(t=V())||void 0===t||t.remove(c),n=F(F({},n),e),(0,r.Y3)((function(){return y()}))};return t.expose({rerender:b}),function(){return d?j(r.h,u,s,e.tagName):P(r.h,u,s)}}}),E=U,G={name:"EditorComponent",setup(){const e=(0,f.qj)({apiKey:"qagffr3pkuv17a8on1afax661irst1hbr4e6tbv888sz91jc",init:{skin:"fabric",language:"zh_TW",placeholder:"請輸入文章內容",resize:"both",branding:!1,menubar:!1,plugins:"paste importcss searchreplace autolink autosave directionality code visualblocks visualchars fullscreen image link media template codesample table  hr pagebreak nonbreaking anchor insertdatetime lists wordcount textpattern noneditable help",toolbar:"fullscreen | undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor removeformat | image media link"}});return{...(0,f.BK)(e)}},components:{Editor:E}},T=n(89);const B=(0,T.Z)(G,[["render",v]]);var H=B,W=n(9971),$=n(7139),K=n(9242);const z={class:"flex flex-wrap"},R={class:"flex-1 p-2"},Y={class:"flex flex-col"},Z=(0,r._)("span",{class:"modalTitle"},"文章標題",-1),q={class:"primary-red font-bold"},J={class:"flex flex-col"},Q=(0,r._)("span",{class:"modalTitle"},"作者",-1),X={class:"primary-red font-bold"},ee={class:"flex flex-col"},te=(0,r._)("span",{class:"modalTitle"},[(0,r.Uk)("文章摘要 "),(0,r._)("span",{class:"primary-retouch align-top pl-1 text-sm"},"(*非必填)")],-1),ne={class:"flex-1 p-2"},ae={class:"flex flex-col"},oe=(0,r._)("p",{class:"modalTitle"},[(0,r.Uk)(" Tag"),(0,r._)("span",{class:"primary-retouch align-top pl-1 text-sm"},"(*非必填)")],-1),le={class:"flex flex-wrap items-center"},ie={class:"flex flex-col"},re=(0,r._)("span",{class:"modalTitle"},"是否發布",-1),se=(0,r._)("option",{value:!0},"是",-1),ce=(0,r._)("option",{value:!1},"否",-1),ue=[se,ce],de={class:"flex flex-col"},pe=(0,r._)("span",{class:"modalTitle"},[(0,r.Uk)("文章圖片 "),(0,r._)("span",{class:"primary-retouch align-top pl-1 text-sm"},"(*非必需)")],-1),me={key:0,class:"flex flex-col mt-3"},fe=(0,r._)("span",{class:"modalTitle border-t"},"圖片預覽",-1),ge=["src"],ve={class:"flex flex-col mt-3"},he=(0,r._)("span",{class:"modalTitle"},[(0,r.Uk)("文章內容 "),(0,r._)("span",{class:"primary-retouch"},"(*建議開啟全螢幕編輯)")],-1),ye={key:0,class:"primary-red font-bold"};function be(e,t,n,a,o,l){const i=(0,r.up)("Field"),s=W.Ks,c=H;return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("section",z,[(0,r._)("section",R,[(0,r._)("div",Y,[Z,(0,r.Wm)(i,{name:"標題",rules:"required",onInput:a.handleForm,modelValue:a.article.title,"onUpdate:modelValue":t[0]||(t[0]=e=>a.article.title=e),modelModifiers:{trim:!0},class:"modalInput",placeholder:"請輸入標題",type:"text"},null,8,["onInput","modelValue"]),(0,r._)("span",q,(0,$.zw)(n.errors.標題),1)]),(0,r._)("div",J,[Q,(0,r.Wm)(i,{name:"作者",rules:"required",onInput:a.handleForm,modelValue:a.article.author,"onUpdate:modelValue":t[1]||(t[1]=e=>a.article.author=e),modelModifiers:{trim:!0},class:"modalInput",placeholder:"請輸入作者",type:"text"},null,8,["onInput","modelValue"]),(0,r._)("span",X,(0,$.zw)(n.errors.作者),1)]),(0,r._)("div",ee,[te,(0,r.wy)((0,r._)("input",{onInput:t[2]||(t[2]=(...e)=>a.handleForm&&a.handleForm(...e)),"onUpdate:modelValue":t[3]||(t[3]=e=>a.article.description=e),class:"modalInput",placeholder:"請輸入摘要",type:"text"},null,544),[[K.nr,a.article.description]])])]),(0,r._)("section",ne,[(0,r._)("div",ae,[oe,(0,r._)("div",le,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(a.article.tag,(e=>((0,r.wg)(),(0,r.j4)(s,{key:e,class:"mb-3",closable:"","disable-transitions":!1,onClose:t=>a.handleClose(e)},{default:(0,r.w5)((()=>[(0,r.Uk)((0,$.zw)(e),1)])),_:2},1032,["onClose"])))),128))]),a.inputVisible?(0,r.wy)(((0,r.wg)(),(0,r.iD)("input",{key:0,ref:"InputRef","onUpdate:modelValue":t[4]||(t[4]=e=>a.inputValue=e),class:"modalInput",type:"text",onKeyup:t[5]||(t[5]=(0,K.D2)(((...e)=>a.handleInputConfirm&&a.handleInputConfirm(...e)),["enter"])),onBlur:t[6]||(t[6]=(...e)=>a.handleInputConfirm&&a.handleInputConfirm(...e)),placeholder:"新增一些標籤..."},null,544)),[[K.nr,a.inputValue,void 0,{trim:!0}]]):((0,r.wg)(),(0,r.iD)("button",{key:1,type:"button",class:"button-new-tag otherBtn",onClick:t[7]||(t[7]=e=>a.inputVisible=!0)}," + 新增 Tag "))]),(0,r._)("div",ie,[re,(0,r.wy)((0,r._)("select",{onChange:t[8]||(t[8]=(...e)=>a.handleForm&&a.handleForm(...e)),"onUpdate:modelValue":t[9]||(t[9]=e=>a.article.isPublic=e),class:"modalInput"},ue,544),[[K.bM,a.article.isPublic]])])])]),(0,r._)("section",null,[(0,r._)("div",de,[pe,(0,r._)("input",{name:"file-to-upload",type:"file",ref:"file",accept:"image/*",onChange:t[10]||(t[10]=e=>a.getFile(e))},null,544)]),a.article.image?((0,r.wg)(),(0,r.iD)("div",me,[fe,(0,r._)("img",{src:a.article.image,alt:"文章圖片"},null,8,ge)])):(0,r.kq)("",!0),(0,r._)("div",ve,[he,(0,r.Wm)(c,{modelValue:a.article.content,"onUpdate:modelValue":t[11]||(t[11]=e=>a.article.content=e)},null,8,["modelValue"]),a.article.content?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("span",ye,"文章內容 為必填"))])])],64)}var De=n(5708),we={name:"ArticleTemplate",props:{articleData:{type:Object,required:!0},errors:{type:Object}},emits:["getFormData"],setup(e,{emit:t}){const n=(0,f.Vh)(e,"articleData"),a=(0,f.iH)(""),o=(0,f.iH)(!1),l=(0,f.iH)(null),i=(0,g.oR)(),s=(0,r.f3)("$ElNotification"),c=e=>{l.value=e.target.files[0],u(l.value)},u=e=>{if(!e)return;const t=new FormData;t.append("file-to-upload",e);const a="https://vue3-course-api.hexschool.io/api/traveljp/admin/upload";i.commit("ISLOADING",!0),m().post(a,t).then((e=>{e.data.success?(n.value.image=e.data.imageUrl,v()):s({title:"錯誤",message:`${e.data.message}`,type:"error"}),i.commit("ISLOADING",!1)})).catch((e=>{e&&i.commit("ISLOADING",!1)}))},d=e=>{n.value.tag.splice(n.value.tag.indexOf(e),1)},p=()=>{a.value&&n.value.tag.push(a.value),o.value=!1,a.value="",v()},v=()=>{t("getFormData",n.value)};return{props:e,article:n,inputValue:a,inputVisible:o,handleForm:v,handleClose:d,handleInputConfirm:p,getFile:c}},components:{Field:De.gN,Editor:H}};const Ie=(0,T.Z)(we,[["render",be]]);var Ce=Ie,_e=n(3857),xe={name:"BArticle",setup(){const e=(0,f.iH)(!1),t=(0,f.iH)(!1),n=(0,f.iH)(!1),a=(0,r.f3)("$ElNotification"),o=(0,g.oR)(),l=(0,f.iH)([]),i=(0,f.iH)({}),s=(0,f.iH)({}),c=e=>{p(e)},u=(e,t)=>{n.value?s.value={title:"",description:"",image:"",tag:[],author:"",isPublic:!1,content:""}:(s.value=e,"del"!==t&&v(e.id))},d=e=>{s.value=e},p=e=>{const t=`https://vue3-course-api.hexschool.io/api/traveljp/admin/articles?page=${e}`;o.commit("ISLOADING",!0),m().get(t).then((e=>{e.data.success?(l.value=e.data.articles,l.value.forEach((e=>{e.cn_isPublic=e.isPublic?"是":"否"})),i.value=e.data.pagination):a({title:"錯誤",message:e.data.message,type:"error"}),o.commit("ISLOADING",!1)})).catch((e=>{e&&o.commit("ISLOADING",!1)}))},v=e=>{const t=`https://vue3-course-api.hexschool.io/api/traveljp/admin/article/${e}`;o.commit("ISLOADING",!0),m().get(t).then((e=>{e.data.success?s.value.content=e.data.article.content:a({title:"錯誤",message:e.data.message,type:"error"}),o.commit("ISLOADING",!1)})).catch((e=>{e&&o.commit("ISLOADING",!1)}))},h=e=>{let t="",l="";n.value?(t="https://vue3-course-api.hexschool.io/api/traveljp/admin/article",l="post"):(t=`https://vue3-course-api.hexschool.io/api/traveljp/admin/article/${e.id}`,l="put");const i=new Date,r=i.getFullYear(),s=(0,_e.vL)(i.getMonth()+1),c=(0,_e.vL)(i.getDate());e={...e,create_at:(new Date).getTime(),create_at_form:`${r}-${s}-${c}`},o.commit("ISLOADING",!0),m()[l](t,{data:e}).then((e=>{e.data.success?(a({title:"成功",message:`${e.data.message}`,type:"success"}),p(1)):(a({title:"錯誤",message:`${e.data.message}`,type:"error"}),o.commit("ISLOADING",!1))})).catch((e=>{e&&o.commit("ISLOADING",!1)}))},y=e=>{const n=`https://vue3-course-api.hexschool.io/api/traveljp/admin/article/${e.id}`;o.commit("ISLOADING",!0),m()["delete"](n).then((e=>{e.data.success?(a({title:"成功",message:`${e.data.message}`,type:"success"}),p(1),t.value=!1):(o.commit("ISLOADING",!1),a({title:"錯誤",message:`${e.data.message}`,type:"error"}))})).catch((e=>{e&&o.commit("ISLOADING",!1)}))};return(0,r.bv)((()=>{p(1)})),{rows:l,paginationInfo:i,isNew:n,articleData:s,isOpenModal:e,isOpenDelModal:t,changePage:c,getFormData:d,sendModalData:h,getModalData:u,delArticle:y,getArticleDetail:v}},components:{Pagination:l.Z,CommonModal:o.Z,DelCommonModal:a.Z,Template:Ce,Form:De.l0}};const Se=(0,T.Z)(xe,[["render",d]]);var Oe=Se}}]);